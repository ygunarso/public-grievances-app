<section>
    <p>Welcome {{sessionInfo}}</p>
    <h2>HOME PAGE !!</h2>

    <a href="issues/createIssue">Create Issue</a>
    <br>
    <br>

    <a href="/profile"> View Your Profile</a>
    <br>
    <br>
    <a href="/ViewAllMyIssues">View All My Issues</a>
    <br>
    <br>
    
    <p style="display: inline"><b>Current Location:</b></p>
    <p id=city style="display: inline"></p>
    <p style="display: inline">, </p>
    <p id=state style="display: inline"></p>
    <br>
    
    <form method="POST" action="/viewNearbyIssues">
        <input hidden name="latitude" id="latitude">
        <input hidden name="longitude" id="longitude">
        <br> 
        <label for="radius"><b>Radius:</b></label>
        <input type="number" name="radius" value="0" style="height:28px; font-size:medium; width:120px">
        <button type="submit"><b>View Nearby Issues</b></button>
    </form>

    <div id="map"></div>
    <script>

      // The following example creates a marker in Stockholm, Sweden using a DROP
      // animation. Clicking on the marker will toggle the animation between a BOUNCE
      // animation and no animation.

      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: {lat: 59.325, lng: 18.070}
        });
        let loc, pos;
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                document.getElementById("latitude").value = pos.lat;
                document.getElementById("longitude").value = pos.lng;
                var geocoder = new google.maps.Geocoder();
                var infowindow = new google.maps.InfoWindow();
                geocode(geocoder, pos, infowindow);
                map.setCenter(pos);
            });
        }
        {{#each issueList}}
            var marker = new google.maps.Marker({
              map: map,
              position: { lat: {{this.latitude}}, lng: {{this.longitude}} }
            });
            var infowindow = new google.maps.InfoWindow();
            infowindow.setContent("{{this.name}}");
            infowindow.open(map, marker);
        {{/each}}

      }

      function geocode(geocoder, pos) {
          geocoder.geocode({'location': pos}, function(results, status) {
              if (status == 'OK') {
                  if (results[0]) {
                      const addr = results[0].address_components;
                      const city = addr.find(obj => JSON.stringify(obj.types) == JSON.stringify(["locality", "political"]));
                      const state = addr.find(obj => JSON.stringify(obj.types) == JSON.stringify(["administrative_area_level_1", "political"]));
                      document.getElementById("city").textContent = city.short_name;
                      document.getElementById("state").textContent = state.long_name;
                  }
              }
          });
      }

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDs-DaFuYDPJ1ThmZywl6Ve2AMTB03iSGI&callback=initMap">
    </script>

    <form id="login-form" method="GET" action="/logout">
        <button type="submit" style = "position:fixed; right:10px; top:10px"><b>Logout</b></button>
    </form>
</section>
