<h2>Create an Issue</h2>
<div id="map"></div>
<script>

  // The following example creates a marker in Stockholm, Sweden using a DROP
  // animation. Clicking on the marker will toggle the animation between a BOUNCE
  // animation and no animation.

  var marker;

  function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 16,
      center: {lat: 59.325, lng: 18.070}
    });
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };
            document.getElementById("latitude").value = pos.lat;
            document.getElementById("longitude").value = pos.lng;
            var geocoder = new google.maps.Geocoder;

            geocode(geocoder, pos);
            map.setCenter(pos);
            marker.setPosition(pos);
            var date = new Date();
            var formatted_date = date.getFullYear().toString() + '-' +
                                (date.getMonth() + 1).toString().padStart(2, 0) +
                                '-' + date.getDate().toString().padStart(2, 0);
            var min_date = (date.getFullYear() - 1).toString() + '-' +
                                (date.getMonth() + 1).toString().padStart(2, 0) +
                                '-' + date.getDate().toString().padStart(2, 0);
            console.log(min_date);
            console.log(formatted_date);

            document.getElementById("date").value = formatted_date;
            document.getElementById("date").min = min_date;
            document.getElementById("date").max = formatted_date;
        });
    }

    marker = new google.maps.Marker({
      map: map,
      draggable: true,
      animation: google.maps.Animation.DROP,
      position: {lat: 59.327, lng: 18.067}
    });
    marker.addListener('drag', toggleBounce);
    marker.addListener('dragend', toggleDragend);

  }

  function toggleDragend() {
      var pos_dragend = {
          lat: marker.getPosition().lat(),
          lng: marker.getPosition().lng()
      }
      var geocoder2 = new google.maps.Geocoder;
      geocode(geocoder2, pos_dragend);
  }

  function geocode(geocoder, pos) {
      geocoder.geocode({'location': pos}, function(results, status) {
          if (status == 'OK') {
              if (results[0]) {
                  const addr = results[0].address_components;
                  const city = addr.find(obj => JSON.stringify(obj.types) == JSON.stringify(["locality", "political"]));
                  const state = addr.find(obj => JSON.stringify(obj.types) == JSON.stringify(["administrative_area_level_1", "political"]));
                  document.getElementById("city").value = city.short_name;
                  document.getElementById("state").value = state.long_name;
                  document.getElementById("select").value = state.short_name;
              }
          }
      });
  }

  function toggleBounce() {
    //if (marker.getAnimation() !== null) {
      //marker.setAnimation(null);
    //} else {
      //marker.setAnimation(google.maps.Animation.BOUNCE);
      var lat = marker.getPosition().lat();
      var lng = marker.getPosition().lng();
      document.getElementById("latitude").value = lat;
      document.getElementById("longitude").value = lng;
    }

</script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDs-DaFuYDPJ1ThmZywl6Ve2AMTB03iSGI&callback=initMap">
</script>
<p id="test"></p>
<form method="POST" action="createIssue">
    <label>Issue Name </label>
    <input type="text" id="name" name="name" required>
    <br>
    <br>
    <label>Issue Category </label>
    <select id="category" name="category">
        <option value="Garbage Dump">Garbage Dump</option>
        <option value="Wrong Parking">Wrong Parking</option>
        <option value="Bad Roads">Bad Roads</option>
    </select>
    <br>
    <br>
    <label for="date">Issue Date:</label>
    <input type="date" id="date" name="date" min="1990-01-01">
    <br>
    <br>
    <label>Latitude </label>
    <input type="text" id="latitude" name="latitude" readonly>
    <br>
    <br>
    <label>Longitude </label>
    <input type="text" id="longitude" name="longitude" readonly>
    <br>
    <br>
    <label>City </label>
    <input type="text" id="city" name="city" readonly>
    <br>
    <br>
    <label for="state">Choose a State:</label>
    <input type="hidden" id="state" name="state">
    <select id="select" name="select" disabled="true">
        <option value="AL">Alabama</option>
        <option value="AK">Alaska</option>
        <option value="AZ">Arizona</option>
        <option value="AR">Arkansas</option>
        <option value="CA">California</option>
        <option value="CO">Colorado</option>
        <option value="CT">Connecticut</option>
        <option value="DE">Delaware</option>
        <option value="DC">District of Columbia</option>
        <option value="FL">Florida</option>
        <option value="GA">Georgia</option>
        <option value="HI">Hawaii</option>
        <option value="ID">Idaho</option>
        <option value="IL">Illinois</option>
        <option value="IN">Indiana</option>
        <option value="IA">Iowa</option>
        <option value="KS">Kansas</option>
        <option value="KY">Kentucky</option>
        <option value="LA">Louisiana</option>
        <option value="ME">Maine</option>
        <option value="MD">Maryland</option>
        <option value="MA">Massachusetts</option>
        <option value="MI">Michigan</option>
        <option value="MN">Minnesota</option>
        <option value="MS">Mississippi</option>
        <option value="MO">Missouri</option>
        <option value="MT">Montana</option>
        <option value="NE">Nebraska</option>
        <option value="NV">Nevada</option>
        <option value="NH">New Hampshire</option>
        <option value="NJ">New Jersey</option>
        <option value="NM">New Mexico</option>
        <option value="NY">New York</option>
        <option value="NC">North Carolina</option>
        <option value="ND">North Dakota</option>
        <option value="OH">Ohio</option>
        <option value="OK">Oklahoma</option>
        <option value="OR">Oregon</option>
        <option value="PA">Pennsylvania</option>
        <option value="RI">Rhode Island</option>
        <option value="SC">South Carolina</option>
        <option value="SD">South Dakota</option>
        <option value="TN">Tennessee</option>
        <option value="TX">Texas</option>
        <option value="UT">Utah</option>
        <option value="VT">Vermont</option>
        <option value="VA">Virginia</option>
        <option value="WA">Washington</option>
        <option value="WV">West Virginia</option>
        <option value="WI">Wisconsin</option>
        <option value="WY">Wyoming</option>
    </select>
    <br>
    <br>
    <button type="submit">Submit</button>
    <br>
    <br>

</form>
